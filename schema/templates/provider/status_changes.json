{
  "status_changes": {
    "$id": "#/properties/data/properties/status_changes",
    "type": "array",
    "title": "The status_changes payload",
    "items": {
      "$id": "#/properties/data/properties/status_changes/items",
      "type": "object",
      "title": "The status_change item schema",
      "additionalProperties": false,
      "required": [
        "event_type",
        "event_type_reason",
        "event_time",
        "event_location"
      ],
      "properties": {
        "event_time": {
          "$id": "#/properties/data/properties/status_changes/items/properties/event_time",
          "$ref": "#/definitions/timestamp",
          "description": "The time the event occurred, expressed as a Unix Timestamp"
        },
        "publication_time": {
          "$id": "#/properties/data/properties/status_changes/items/properties/publication_time",
          "$ref": "#/definitions/timestamp",
          "description": "The time the event became available through the status changes endpoint, expressed as a Unix Timestamp"
        },
        "event_location": {
          "$id": "#/properties/data/properties/status_changes/items/properties/event_location",
          "$ref": "#/definitions/MDS_Feature_Point",
          "description": "The GPS or GNSS coordinates of where the event occurred"
        },
        "event_type": {
          "$id": "#/properties/data/properties/status_changes/items/properties/event_type",
          "type": "string",
          "description": "The type of the event"
        },
        "event_type_reason": {
          "$id": "#/properties/data/properties/status_changes/items/properties/event_type_reason",
          "type": "string",
          "description": "The reason for the event"
        },
        "battery_pct": {
          "$id": "#/properties/data/properties/status_changes/items/properties/battery_pct",
          "type": [
            "number",
            "null"
          ],
          "description": "Percent charge of device battery, expressed between 0 and 1",
          "examples": [
            0.89
          ],
          "minimum": 0,
          "maximum": 1
        },
        "associated_trip": {
          "$id": "#/properties/data/properties/status_changes/items/properties/associated_trip",
          "$ref": "#/definitions/uuid",
          "description": "Trip UUID, required if event_type is user_pick_up or user_drop_off"
        },
        "associated_ticket": {
          "$id": "#/properties/data/properties/status_changes/items/properties/associated_ticket",
          "$ref": "#/definitions/string",
          "description": "Identifier for an associated ticket inside an Agency-maintained 311 or CRM system."
        }
      },
      "allOf": [
        {
          "description": "valid event_type and event_type_reason combinations",
          "oneOf": [
            {
              "properties": {
                "event_type": {
                  "enum": [
                    "available"
                  ]
                },
                "event_type_reason": {
                  "enum": [
                    "service_start",
                    "user_drop_off",
                    "rebalance_drop_off",
                    "maintenance_drop_off",
                    "agency_drop_off"
                  ]
                }
              }
            },
            {
              "properties": {
                "event_type": {
                  "enum": [
                    "reserved"
                  ]
                },
                "event_type_reason": {
                  "enum": [
                    "user_pick_up"
                  ]
                }
              }
            },
            {
              "properties": {
                "event_type": {
                  "enum": [
                    "unavailable"
                  ]
                },
                "event_type_reason": {
                  "enum": [
                    "low_battery",
                    "maintenance"
                  ]
                }
              }
            },
            {
              "properties": {
                "event_type": {
                  "enum": [
                    "removed"
                  ]
                },
                "event_type_reason": {
                  "enum": [
                    "service_end",
                    "rebalance_pick_up",
                    "maintenance_pick_up",
                    "agency_pick_up"
                  ]
                }
              }
            }
          ]
        },
        {
          "description": "conditionally require associated_trip when applicable",
          "anyOf": [
            {
              "not": {
                "properties": {
                  "event_type_reason": {
                    "enum": [
                      "user_pick_up",
                      "user_drop_off"
                    ]
                  }
                }
              }
            },
            {
              "required": [
                "associated_trip"
              ]
            }
          ]
        }
      ]
    }
  }
}